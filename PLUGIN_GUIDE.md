# XMWmax 插件开发指南

XMWmax 是一个可扩展的用户脚本平台，允许开发者创建插件来增强小码王网站的功能。本指南将详细介绍如何开发、测试和发布 XMWmax 插件。

## 目录

- [插件基本结构](#插件基本结构)
- [插件基本结构（JSON格式）](#插件基本结构json格式)
- [插件开发最佳实践](#插件开发最佳实践)
- [插件管理功能](#插件管理功能)
- [自定义样式功能](#自定义样式功能)
- [插件市场](#插件市场)
  - [浏览和安装插件](#浏览和安装插件)
  - [自定义插件仓库](#自定义插件仓库)
- [插件格式转换工具](#插件格式转换工具)
- [插件发布](#插件发布)
  - [通过官方插件市场发布](#通过官方插件市场发布)
  - [通过自定义仓库发布](#通过自定义仓库发布)
  - [通过URL直接分发](#通过url直接分发)
- [常见问题和故障排除](#常见问题和故障排除)
- [获取帮助](#获取帮助)

## 插件基本结构

一个 XMWmax 插件是一个 JavaScript 对象，包含特定的属性和方法。以下是插件的基本结构：

```
{
    // 必需属性
    name: '插件名称',
    version: '插件版本',
    author: '作者名称',
    description: '插件简短描述',
  
    // 可选属性
    enabled: true, // 插件默认是否启用
  
    // 必需方法 - 插件初始化入口
    init: function() {
        // 插件的主要功能代码
        // 在这里实现插件的具体功能
    },
  
    // 可选元数据
    meta: {
        lastModified: '2023-01-01T00:00:00.000Z',
        source: 'user_defined',
        type: 'script'
    }
}
```

### 必需属性说明

| 属性名          | 类型     | 描述                               |
| --------------- | -------- | ---------------------------------- |
| `name`        | String   | 插件的唯一名称，用于标识插件       |
| `version`     | String   | 插件版本号，建议使用语义化版本控制 |
| `author`      | String   | 插件作者名称                       |
| `description` | String   | 插件功能的简要描述                 |
| `init`        | Function | 插件初始化函数，在插件启用时执行   |

### 可选属性说明

| 属性名      | 类型    | 默认值 | 描述                                           |
| ----------- | ------- | ------ | ---------------------------------------------- |
| `enabled` | Boolean | true   | 插件默认是否启用                               |
| `meta`    | Object  | {}     | 插件元数据，包含最后修改时间、来源和类型等信息 |

### 示例插件（JavaScript对象格式）

```
{
    name: '示例插件',
    version: '1.0.0',
    author: '开发者',
    description: '这是一个示例插件，展示了插件的基本结构',
    enabled: true,
    init: function() {
        alert('示例插件已加载！');
    }
}
```

## 插件基本结构（JSON格式）

当通过插件市场或从URL加载插件时，插件必须使用严格的JSON格式：

```
{
    "name": "示例插件",
    "version": "1.0.0",
    "author": "开发者",
    "description": "这是一个示例插件，展示了插件的基本结构",
    "enabled": true,
    "init": "function() {\n    alert('示例插件已加载！');\n}"
}
```

### JSON格式要求

1. 所有键名必须使用双引号括起来
2. 所有字符串值必须使用双引号
3. 函数必须序列化为字符串格式
4. 不允许尾随逗号
5. 不允许注释

### 格式转换示例

**JavaScript 对象格式（用于手动添加插件）：**

```
{
    name: '示例插件',
    version: '1.0.0',
    author: '开发者',
    description: '这是一个示例插件',
    init: function() {
        alert('示例插件已加载！');
    }
}
```

**JSON 格式（用于插件市场）：**

```
{
    "name": "示例插件",
    "version": "1.0.0",
    "author": "开发者",
    "description": "这是一个示例插件",
    "init": "function() {\n    alert('示例插件已加载！');\n}"
}
```

## 插件开发最佳实践

在开发 XMWmax 插件时，请遵循以下最佳实践：

### 1. 命名规范

- 为插件选择一个独特且描述性的名称
- 使用语义化版本号（如 1.0.0, 1.1.4, 5.1.4等）
- 提供清晰的作者信息

### 2. 错误处理

在 `init` 函数中使用 try-catch 块处理可能的错误：

```
{
    name: '健壮的插件示例',
    version: '1.0.0',
    author: '开发者',
    description: '展示错误处理的最佳实践',
    init: function() {
        try {
            // 插件的主要功能代码
            console.log('插件功能执行中...');
        } catch (error) {
            console.error('插件执行出错:', error);
        }
    }
}
```

### 3. 避免冲突

- 避免修改 XMWmax 核心代码
- 插件应保持独立性，尽量不依赖其他特定插件
- 使用唯一的 CSS 类名和 ID

### 4. 性能优化

- 避免在 `init` 函数中执行耗时操作
- 合理使用事件监听器，避免内存泄漏
- 在不需要时移除事件监听器

## 插件加载方式

XMWmax 提供多种方式加载插件：

### 1. 通过管理界面手动添加

1. 打开 XMWmax 管理界面（点击页面右下角的 XMWmax 按钮）
2. 点击左侧"开发者选项"图标（需要先在系统设置中启用开发者模式）
3. 在"导入插件"区域粘贴插件代码
4. 点击"添加插件"按钮

### 2. 通过管理界面从 URL 加载

1. 打开 XMWmax 管理界面
2. 点击左侧"插件市场"图标
3. 在"从URL添加"区域输入插件的 URL
4. 点击"加载插件"按钮

### 3. 使用插件模板

XMWmax 提供了插件模板功能，可以帮助开发者快速开始插件开发：

1. 打开 XMWmax 管理界面
2. 点击左侧"开发者选项"图标
3. 点击"插件模板"按钮
4. 模板代码将自动填充到插件代码编辑区域

## 插件管理功能

通过 XMWmax 管理界面，用户可以方便地管理插件：

### 启用/禁用插件

- 点击插件卡片上的"启用"或"禁用"按钮切换插件状态
- 禁用的插件不会在页面加载时执行

### 编辑插件

- 点击"编辑"按钮可将插件完整代码加载到编辑区进行修改
- 系统会正确处理函数序列化和反序列化问题
- 编辑功能仅在启用开发者模式时可用
- **注意：该功能需要启用开发者模式后才可以使用**

### 删除插件

- 点击"删除"按钮并确认后移除插件
- 删除操作不可恢复，请谨慎操作

### 重名检测

- 系统会检查插件名称和作者是否已存在
- 如果存在同名插件，系统会提示是否替换

### 搜索插件

- 在"已安装插件"页面顶部提供搜索框
- 可以根据插件名称、作者或描述进行搜索

## 自定义样式功能

XMWmax 支持用户自定义网站样式，通过"已安装样式"功能可以添加、启用/禁用和删除自定义 CSS 样式。

### 样式管理方式

1. 在 XMWmax 管理界面中选择"已安装样式"标签
2. 在"样式管理"区域输入样式名称和 CSS 代码
3. 点击"添加样式"按钮保存并应用样式
4. 在"已保存样式"区域可以启用/禁用或删除已保存的样式

### 样式编写要求和规范

1. 样式代码必须是标准的 CSS 语法
2. 样式会直接应用到整个网页，具有较高优先级
3. 建议使用具体的选择器避免影响不必要的元素
4. 可以使用 `!important` 来提高样式优先级（谨慎使用）

### 示例样式代码

以下是一些示例样式代码，可以直接使用或作为参考：

#### 1. 修改文字颜色和字体

```
* {
    color: #333 !important;
    font-family: 'Microsoft YaHei', sans-serif !important;
}
```

#### 2. 修改链接颜色

```
a {
    color: #007bff !important;
}

a:hover {
    color: #0056b3 !important;
}
```

#### 3. 隐藏特定元素

```
/* 隐藏页脚 */
footer {
    display: none !important;
}
```

#### 4. 修改按钮样式

```
button, .btn {
    background: linear-gradient(45deg, #007bff, #0056b3) !important;
    border: none !important;
    color: white !important;
    border-radius: 5px !important;
    padding: 8px 16px !important;
    cursor: pointer !important;
}
```

## 插件市场

XMWmax 提供了插件市场功能，用户可以方便地浏览、安装和管理插件和样式。

### 浏览和安装插件

1. 打开 XMWmax 管理界面
2. 点击左侧"插件市场"图标
3. 浏览可用的插件
4. 点击"安装"按钮进行安装

插件安装后会出现在"已安装插件"列表中，需要手动启用后才会执行。

样式插件在列表中会有特殊标识（[样式]标签和左侧紫色边框）以便区分。

### 自定义插件仓库

用户可以通过以下步骤设置自定义插件仓库：

1. 打开 XMWmax 管理界面
2. 点击左侧"系统设置"图标
3. 在"插件市场设置"区域输入仓库 URL
4. 点击"保存设置"按钮

自定义仓库需要遵循与官方仓库相同的目录结构和文件格式。

### 插件市场搜索

- 插件市场页面提供搜索功能
- 可以根据插件名称、作者或描述进行搜索
- 搜索框位于插件列表上方

### 刷新插件列表

- 点击"刷新插件列表"按钮可以重新加载插件市场数据
- 当插件仓库有更新时可以使用此功能获取最新列表

## 插件格式转换工具

XMWmax 内置了插件格式转换工具，可以帮助开发者在 JavaScript 对象格式和 JSON 格式之间进行转换：

1. 打开 XMWmax 管理界面
2. 点击左侧"开发者选项"图标（需要先在系统设置中启用开发者模式）
3. 在"插件格式转换"区域输入插件代码
4. 点击"转换为JSON格式"或"转换为JS格式"按钮
5. 转换结果将显示在输出区域，可点击"复制结果"按钮复制

## 插件发布

XMWmax 支持多种插件发布方式，开发者可以选择最适合自己的方式来分发插件。

### 通过官方插件市场发布

这是推荐的插件发布方式，可以让更多用户发现和使用您的插件：

1. 将插件代码托管到官方插件市场仓库：[https://github.com/RSPqfgn/XMWmax-plugins](https://github.com/RSPqfgn/XMWmax-plugins)
2. 在仓库的 `plugins` 文件夹中添加您的插件文件（.js 格式）
3. 确保插件文件遵循 XMWmax 插件规范
4. 提交 Pull Request 或联系仓库维护者添加您的插件
5. 通过审核后，您的插件将出现在官方插件市场中

### 通过自定义仓库发布

如果您希望维护自己的插件仓库，可以按照以下步骤操作：

1. 创建一个 GitHub 仓库（或其他 Git 托管服务）
2. 在仓库中创建 `plugins` 文件夹
3. 将插件文件（.js 格式）放入 `plugins` 文件夹
4. 其他用户可以通过自定义仓库地址来访问您的插件：
   - 打开 XMWmax 管理界面
   - 点击左侧"系统设置"图标
   - 在"插件市场设置"区域输入您的仓库 URL
   - 点击"保存设置"按钮

### 通过URL直接分发

对于简单的插件分发，您可以直接提供插件文件的 URL：

1. 将插件文件托管到任何可公开访问的服务器或代码托管平台
2. 获取插件文件的原始 URL
3. 其他用户可以通过以下方式加载您的插件：
   - 打开 XMWmax 管理界面
   - 点击左侧"插件市场"图标
   - 在"从URL添加"区域输入插件的 URL
   - 点击"加载插件"按钮

### 发布建议

- 为插件编写详细的文档和使用说明
- 在插件代码中添加充分的注释
- 提供插件功能的截图或演示
- 维护插件的更新日志
- 确保插件代码遵循 XMWmax 插件规范
- 使用语义化版本控制（如 1.0.0, 1.1.4, 2.0.0 等）
- 在插件描述中清晰说明插件的功能和使用方法

## 常见问题和故障排除

### 插件无法加载

1. 检查插件代码是否为有效的 JavaScript 对象
2. 确保包含了所有必需的属性（name, version, author, description, init）
3. 检查 init 函数是否正确声明

### 插件功能不生效

1. 检查插件是否已启用
2. 查看浏览器控制台是否有错误信息
3. 确认插件代码是否与当前网页结构匹配

### 样式应用问题

1. 检查 CSS 语法是否正确
2. 使用浏览器开发者工具检查样式是否被覆盖
3. 适当使用 `!important` 提高样式优先级

### 部分功能未显示

1. 从官方渠道升级到最新版本
2. 检查是否启用开发者选项
3. 检查是否为插件导致的异常

## 获取帮助

如果您在插件开发过程中遇到问题：

1. 查看本指南和示例代码
2. 查阅 XMWmax 主脚本的源代码
3. 在项目 GitHub 仓库提交 issue
