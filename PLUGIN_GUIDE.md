# XMWmax 插件开发指南

XMWmax 是一个可扩展的用户脚本平台，允许开发者创建插件来增强小码王网站的功能。本指南将详细介绍如何开发、测试和发布 XMWmax 插件。

## 插件基本结构

一个 XMWmax 插件是一个 JavaScript 对象，包含特定的属性和方法。以下是插件的基本结构：

```javascript
{
    // 必需属性
    name: '插件名称',
    version: '插件版本',
    author: '作者名称',
    description: '插件简短描述',
    
    // 可选属性
    enabled: true, // 插件默认是否启用
    
    // 必需方法 - 插件初始化入口
    init: function() {
        // 插件的主要功能代码
        // 在这里实现插件的具体功能
    }
}
```

### 必需属性说明

| 属性名 | 类型 | 描述 |
|--------|------|------|
| `name` | String | 插件的唯一名称，用于标识插件 |
| `version` | String | 插件版本号，建议使用语义化版本控制 |
| `author` | String | 插件作者名称 |
| `description` | String | 插件功能的简要描述 |
| `init` | Function | 插件初始化函数，在插件启用时执行 |

### 可选属性说明

| 属性名 | 类型 | 默认值 | 描述 |
|--------|------|--------|------|
| `enabled` | Boolean | true | 插件默认是否启用 |

### 示例插件（JavaScript对象格式）

``javascript
{
    name: '示例插件',
    version: '1.0.0',
    author: '开发者',
    description: '这是一个示例插件，展示了插件的基本结构',
    enabled: true,
    init: function() {
        alert('示例插件已加载！');
    }
}
```

## 插件基本结构（JSON格式）

当通过插件市场或从URL加载插件时，插件必须使用严格的JSON格式：

```json
{
    "name": "示例插件",
    "version": "1.0.0",
    "author": "开发者",
    "description": "这是一个示例插件，展示了插件的基本结构",
    "enabled": true,
    "init": "function() {\n    alert('示例插件已加载！');\n}"
}
```

### JSON格式要求

1. 所有键名必须使用双引号括起来
2. 所有字符串值必须使用双引号
3. 函数必须序列化为字符串格式
4. 不允许尾随逗号
5. 不允许注释

### 格式转换示例

**JSON 格式（推荐）：**
```
{
    "name": "示例插件",
    "version": "1.0.0",
    "author": "开发者",
    "description": "这是一个示例插件",
    "init": "function() {\n    alert('示例插件已加载！');\n}"
}
```

**JavaScript 对象格式（不适用于插件市场）：**
```
{
    name: '示例插件',
    version: '1.0.0',
    author: '开发者',
    description: '这是一个示例插件',
    init: function() {
        alert('示例插件已加载！');
    }
}
```


## 插件开发最佳实践

在开发 XMWmax 插件时，请遵循以下最佳实践：

### 1. 命名规范
- 为插件选择一个独特且描述性的名称
- 使用语义化版本号（如 1.0.0, 1.1.4, 5.1.4等）
- 提供清晰的作者信息

### 2. 错误处理
在 `init` 函数中使用 try-catch 块处理可能的错误：

``javascript
{
    name: '健壮的插件示例',
    version: '1.0.0',
    author: '开发者',
    description: '展示错误处理的最佳实践',
    init: function() {
        try {
            // 插件的主要功能代码
            console.log('插件功能执行中...');
        } catch (error) {
            console.error('插件执行出错:', error);
        }
    }
}
```

### 3. 避免冲突
- 避免修改 XMWmax 核心代码
- 插件应保持独立性，尽量不依赖其他特定插件
- 使用唯一的 CSS 类名和 ID

### 4. 性能优化
- 避免在 `init` 函数中执行耗时操作
- 合理使用事件监听器，避免内存泄漏
- 在不需要时移除事件监听器

## 插件加载方式

XMWmax 提供多种方式加载插件：

### 1. 通过管理界面手动添加

1. 打开 XMWmax 管理界面（点击页面右下角的 XMWmax 按钮）
2. 点击左侧"添加插件"图标
3. 在"手动添加插件"区域粘贴插件代码
4. 点击"添加插件"按钮

### 2. 通过管理界面从 URL 加载

1. 打开 XMWmax 管理界面
2. 点击左侧"添加插件"图标
3. 在"从URL添加"区域输入插件的 URL
4. 点击"加载插件"按钮

## 插件管理功能

通过 XMWmax 管理界面，用户可以方便地管理插件：

### 启用/禁用插件
- 点击插件卡片上的"启用"或"禁用"按钮切换插件状态
- 禁用的插件不会在页面加载时执行

### 编辑插件
- 点击"编辑"按钮可将插件完整代码加载到编辑区进行修改
- 系统会正确处理函数序列化和反序列化问题

### 删除插件
- 点击"删除"按钮并确认后移除插件
- 删除操作不可恢复，请谨慎操作

### 重名检测
- 系统会检查插件名称和作者是否已存在
- 如果存在同名插件，系统会提示是否替换

## 自定义样式功能

XMWmax 支持用户自定义网站样式，通过"已安装样式"功能可以添加、启用/禁用和删除自定义 CSS 样式。

### 样式管理方式

1. 在 XMWmax 管理界面中选择"已安装样式"标签
2. 在"样式管理"区域输入样式名称和 CSS 代码
3. 点击"添加样式"按钮保存并应用样式
4. 在"已保存样式"区域可以启用/禁用或删除已保存的样式

### 样式编写要求和规范

1. 样式代码必须是标准的 CSS 语法
2. 样式会直接应用到整个网页，具有较高优先级
3. 建议使用具体的选择器避免影响不必要的元素
4. 可以使用 `!important` 来提高样式优先级（谨慎使用）

### 示例样式代码

以下是一些示例样式代码，可以直接使用或作为参考：

#### 1. 修改文字颜色和字体
```
* {
    color: #333 !important;
    font-family: 'Microsoft YaHei', sans-serif !important;
}
```

#### 2. 修改链接颜色
```
a {
    color: #007bff !important;
}

a:hover {
    color: #0056b3 !important;
}
```

#### 3. 隐藏特定元素
```
/* 隐藏页脚 */
footer {
    display: none !important;
}
```

#### 4. 修改按钮样式
```
button, .btn {
    background: linear-gradient(45deg, #007bff, #0056b3) !important;
    border: none !important;
    color: white !important;
    border-radius: 5px !important;
    padding: 8px 16px !important;
    cursor: pointer !important;
}
```

## 插件发布

要发布您的插件供他人使用：

1. 将插件代码托管到可公开访问的代码托管平台（如 GitHub、Gitee 等）
2. 获取插件文件的原始 URL
3. 其他用户可以通过"从URL添加"功能加载您的插件

未来将计划编写插件市场，方便用户查找、安装和管理插件。

### 发布建议

- 为插件编写详细的文档和使用说明
- 在插件代码中添加充分的注释
- 提供插件功能的截图或演示
- 维护插件的更新日志

## 常见问题和故障排除

### 插件无法加载

1. 检查插件代码是否为有效的 JavaScript 对象
2. 确保包含了所有必需的属性（name, version, author, description, init）
3. 检查 init 函数是否正确声明

### 插件功能不生效

1. 检查插件是否已启用
2. 查看浏览器控制台是否有错误信息
3. 确认插件代码是否与当前网页结构匹配

### 样式应用问题

1. 检查 CSS 语法是否正确
2. 使用浏览器开发者工具检查样式是否被覆盖
3. 适当使用 `!important` 提高样式优先级

## 获取帮助

如果您在插件开发过程中遇到问题：

1. 查看本指南和示例代码
2. 查阅 XMWmax 主脚本的源代码
3. 在项目 GitHub 仓库提交 issue